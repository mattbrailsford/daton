/* DATON.js */(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.DATON=b()})(this,function(){'use strict';var a=function(){var a=/^[\t ]*(?:\{[\w\W]*\}|\[[\w\W]*\])[\t ]*$/g,b=/([^'\\]*(?:\\.[^'\\]*)*)'/g,c=/\\'/g,d=function(a){return'object'==typeof a},e=function(a){return d(a)&&a.constructor===Array},f=function(b){return b.match(a)},g=function(a){var d=JSON.parse(a.replace(b,'$1"').replace(c,'\''));return e(d)?d.reduce(function(a,b){return a[b]=b,a},{}):d},h=function(a,b,c){if(b)a[b]=c;else if(e(a))a.push(c);else throw'Unable to set value as there is no setable key for value "'+c+'"';return c},j=function(a,b,c){switch(b.type){case'array':return h(c,b.cfg,[]);case'object':return h(c,b.cfg,{});case'attribute':if(f(b.cfg)){var d=g(b.cfg);for(var e in d)h(c,e,a.getAttribute(d[e]))}else h(c,b.cfg,a.getAttribute(b.cfg));break;case'value':if(f(b.cfg)){var i=g(b.cfg);for(var j in i)h(c,j,i[j])}else h(c,b.cfg,a.textContent);}return null},k=function(b,c){if(b.attributes)for(var d,e='data-'+(c?c+'-':''),f=b.attributes,g=0;g<f.length;g++)if(d=f[g],0===d.name.indexOf(e)){var h=d.name.substr(e.length).toLowerCase();switch(h){case'arr':case'array':return{type:'array',cfg:d.value};case'obj':case'object':return{type:'object',cfg:d.value};case'attr':case'attrs':case'attribute':case'attributes':return{type:'attribute',cfg:d.value};case'val':case'vals':case'value':case'values':return{type:'value',cfg:d.value};}}return null},l=function(a,b,c){var d,e=k(a,b);e&&(d=j(a,e,c));var f=a.children;if(f)for(var g=f.length,h=0;h<g;h++)d?l(f[h],b,d):l(f[h],b,c)},i=function(){};return i.prototype.parse=function(a,b,c){return void 0===b&&(b='dtn'),void 0===c&&(c={}),l(a,b,c),c},new i}();return a});
